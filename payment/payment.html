<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <title>payment</title>
  </head>
  <body>
    <style>
      /*  center vertically */
      #payment {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
      }
      #paypal-button-container {
        width: 100%;
        max-width: 600px;
      }
    </style>

    <div id="payment">
      <div id="paypal-button-container"></div>
    </div>

    <script
      src="https://www.paypal.com/sdk/js?client-id=ATmKRMeVmhB9squa27weMutW324SbYZKzD_uCQ_dRlZctyGgMvjCTdDWNBfMuQAf0MvfARWNR65sBJnd&vault=true&intent=subscription"
      data-sdk-integration-source="button-factory"
    ></script>

    <script>
      const id = new URLSearchParams(window.location.search).get("id");

      if (id == null) {
        alert("the url is not valid");
        // redirect to the home page
        window.location.href = "https://t.me/twitterstylebot";
      }

      // check if devise is dark or light
      const isDark = Telegram.WebApp.colorScheme === "dark";
      var Bcolor = "gold";
      if (isDark) {
        document.body.style.backgroundColor = "#1e1e1e";
        var Bcolor = "white";
      }

      function send() {
        // sendData to the bot
        Telegram.WebApp.sendData("close");
      }

      paypal
        .Buttons({
          style: {
            shape: "rect",
            color: Bcolor,
            layout: "vertical",
            label: "subscribe",
          },
          createSubscription: function (data, actions) {
            Telegram.WebApp.expand();
            return actions.subscription.create({
              /* Creates the subscription */
              plan_id: "P-9A182791BX901072KMQFQ2SY",

              purchase_units: [
                {
                  custom_id: id,
                  reference_id: id,
                },
              ],
            });
          },
          onApprove: function (data, actions) {
            alert("payment approved");
            // send to bot the subscriptionID by useing inline query
            subscriptionID = data.subscriptionID;
            Telegram.WebApp.close();
          },
        })
        .render("#paypal-button-container"); // Renders the PayPal button
    </script>
  </body>
</html>
